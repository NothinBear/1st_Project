<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQLMap 2.0//EN"
"http://ibatis.apache.org/dtd/sql-map-2.dtd">

<sqlMap namespace="menuAuthority">


	<typeAlias alias="authorityGroupMenuTO" type="com.estimulo.system.authorityManager.to.AuthorityGroupMenuTO"/>
	<typeAlias alias="menuAuthorityTO" type="com.estimulo.system.authorityManager.to.MenuAuthorityTO"/>

	<resultMap class="authorityGroupMenuTO" id="authorityGroupMenuResult">
		<result property="menuCode" column="MENU_CODE" />
		<result property="menuName" column="MENU_NAME" />
	</resultMap>
	
	<resultMap class="menuAuthorityTO" id="menuAuthorityResult">
		<result property="authority" column="AUTHORITY" />
		<result property="authorityGroupCode" column="AUTHORITY_GROUP_CODE" />
		<result property="menuCode" column="MENU_CODE" />
		<result property="menuName" column="MENU_NAME" />
		<result property="menuLevel" column="MENU_LEVEL" />
	</resultMap>
	
	<select id="selectUserMenuAuthorityList" parameterClass="String" resultMap="authorityGroupMenuResult">
		SELECT m.menu_code, 
	          		       m.MENU_NAME
	          		  FROM AUTHORITY_GROUP_MENU a,
	          		       MENU m 
	          		 WHERE a.MENU_CODE = m.MENU_CODE
	          		       AND AUTHORITY_GROUP_CODE IN
	          		       (SELECT AUTHORITY_GROUP_CODE 
	          		         FROM EMPLOYEE_AUTHORITY
	          		        WHERE EMP_CODE = #empCode#)
	</select>
	
	<select id="selectMenuAuthorityList" parameterClass="String" resultMap="menuAuthorityResult">
		<![CDATA[
		SELECT m.MENU_CODE,
	          		       m.MENU_NAME,
	          		       m.MENU_LEVEL,
	          						a. AUTHORITY_GROUP_CODE,
	          		        CASE 
	          		        WHEN  MENU_LEVEL = '0' THEN '-1'
	          		        WHEN MENU_LEVEL = '1' AND CHILD_MENU IS NOT NULL THEN '-2' 
	          		        WHEN AUTHORITY_GROUP_CODE IS NOT NULL AND MENU_LEVEL <> '0' THEN '1'
	          		        ELSE '0' END authority 
	          		  FROM MENU m, 
	          		       (SELECT *  
	          		         FROM AUTHORITY_GROUP_MENU  
	          		        WHERE AUTHORITY_GROUP_CODE=#authorityGroupCode# 
	          		       ) a 
	          		 WHERE m.MENU_CODE = a.MENU_CODE(+)  
	          		ORDER BY m.MENU_CODE
	     ]]>
	</select>
	
	
	<insert id="insertMenuAuthority" parameterClass="MenuAuthorityTO">
		INSERT INTO AUTHORITY_GROUP_MENU VALUES(#authorityGroupCode#,#menuCode#)	
	</insert>

	<delete id="deleteMenuAuthority" parameterClass="String">
		DELETE AUTHORITY_GROUP_MENU WHERE AUTHORITY_GROUP_CODE=#authorityGroupCode#
	</delete>
</sqlMap>